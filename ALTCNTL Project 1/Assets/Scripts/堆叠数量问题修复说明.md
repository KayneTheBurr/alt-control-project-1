# å †å æ•°é‡ä¸åŒ¹é…é—®é¢˜ä¿®å¤

> **é—®é¢˜**: å®é™…åˆ›å»ºæ•°é‡ä¸é¢„æœŸä¸ç¬¦  
> **é”™è¯¯**: `å®é™…åˆ›å»ºæ•°é‡ (11) ä¸é¢„æœŸ (10) ä¸ç¬¦`  
> **ä¿®å¤æ—¥æœŸ**: 2025-10-13

---

## ğŸ› é—®é¢˜åˆ†æ

### ç°è±¡
```
[StackController] è­¦å‘Šï¼šå®é™…åˆ›å»ºæ•°é‡ (11) ä¸é¢„æœŸ (10) ä¸ç¬¦ï¼
```

### æ ¹æœ¬åŸå› 

**é—®é¢˜1: stackedObjects åœ¨ Inspector ä¸­å¯è§**
```csharp
// ä¿®å¤å‰
public List<GameObject> stackedObjects = new List<GameObject>();
```

- `stackedObjects` æ˜¯ **public** çš„
- åœ¨ Unity Inspector ä¸­ **å¯è§å¯ç¼–è¾‘**
- ç”¨æˆ·å¯èƒ½æ— æ„ä¸­åœ¨ Inspector ä¸­æ·»åŠ äº†ç‰©ä½“åˆ°åˆ—è¡¨
- å¯¼è‡´ `CreateInitialStack()` æ‰§è¡Œå‰åˆ—è¡¨å°±æœ‰ç‰©ä½“äº†

**é—®é¢˜2: æ²¡æœ‰éªŒè¯åˆå§‹çŠ¶æ€**
- ç›´æ¥å¼€å§‹åˆ›å»ºç‰©ä½“ï¼Œä¸æ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©º
- å¦‚æœåˆ—è¡¨å·²æœ‰ç‰©ä½“ï¼Œä¼šå¯¼è‡´æ•°é‡ä¸åŒ¹é…

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤1: éšè— stackedObjects

```csharp
[Header("å †å è®¾ç½®")]
[Tooltip("å †å çš„ç‰©ä½“åˆ—è¡¨ï¼ˆä»ä¸‹åˆ°ä¸Šï¼‰- ç”±ä»£ç è‡ªåŠ¨ç®¡ç†")]
[HideInInspector] // æ–°å¢ï¼šéšè—ä»¥é˜²æ­¢æ‰‹åŠ¨ç¼–è¾‘
public List<GameObject> stackedObjects = new List<GameObject>();
```

**æ•ˆæœ:**
- âœ… Inspector ä¸­ä¸å†æ˜¾ç¤º `stackedObjects`
- âœ… é˜²æ­¢æ„å¤–æ‰‹åŠ¨ç¼–è¾‘
- âœ… ä»ç„¶æ˜¯ publicï¼Œå…¶ä»–è„šæœ¬å¯è®¿é—®

### ä¿®å¤2: æ·»åŠ åˆå§‹çŠ¶æ€æ£€æŸ¥

```csharp
void CreateInitialStack()
{
    if (initialStackCount <= 0)
    {
        Debug.LogWarning("[StackController] initialStackCount ä¸º 0ï¼Œä¸ä¼šåˆ›å»ºç‰©ä½“ï¼");
        return;
    }

    // æ–°å¢ï¼šæ£€æŸ¥åˆå§‹çŠ¶æ€
    int initialCount = stackedObjects != null ? stackedObjects.Count : 0;
    Debug.Log($"[StackController] åˆå§‹çŠ¶æ€æ£€æŸ¥ï¼šstackedObjects ä¸­å·²æœ‰ {initialCount} ä¸ªç‰©ä½“");
    
    if (initialCount > 0)
    {
        Debug.LogWarning($"[StackController] è­¦å‘Šï¼šåœ¨CreateInitialStackä¹‹å‰ï¼ŒstackedObjectså·²ç»æœ‰ {initialCount} ä¸ªç‰©ä½“ï¼å°†æ¸…ç©ºåé‡æ–°åˆ›å»ºã€‚");
        stackedObjects.Clear(); // æ¸…ç©º
    }

    Debug.Log($"[StackController] å¼€å§‹åˆ›å»º {initialStackCount} ä¸ªå †å ç‰©ä½“...");
    // ...
}
```

**æ•ˆæœ:**
- âœ… æ£€æµ‹åˆå§‹çŠ¶æ€
- âœ… å‘ç°é—®é¢˜æ—¶è­¦å‘Š
- âœ… è‡ªåŠ¨æ¸…ç©ºå¹¶é‡æ–°åˆ›å»º
- âœ… ç¡®ä¿æ•°é‡å‡†ç¡®

---

## ğŸ” é—®é¢˜å®šä½æµç¨‹

### æ­¥éª¤1: æ£€æŸ¥ Inspector

1. é€‰ä¸­ SwaySystem GameObject
2. æŸ¥çœ‹ StackController ç»„ä»¶
3. **ä¿®å¤å‰**ï¼šèƒ½çœ‹åˆ° `Stacked Objects` åˆ—è¡¨
4. **ä¿®å¤å**ï¼šåˆ—è¡¨è¢«éšè—

### æ­¥éª¤2: æ£€æŸ¥æ—¥å¿—

ä¿®å¤åè¿è¡Œï¼ŒæŸ¥çœ‹ Consoleï¼š

```
[StackController] åˆå§‹çŠ¶æ€æ£€æŸ¥ï¼šstackedObjects ä¸­å·²æœ‰ 0 ä¸ªç‰©ä½“
[StackController] å¼€å§‹åˆ›å»º 10 ä¸ªå †å ç‰©ä½“...
[StackController] åˆ›å»ºç‰©ä½“ 0: StackObject_0 åœ¨ä½ç½® (0.0, 0.0, 0.0)
...
[StackController] åˆ›å»ºç‰©ä½“ 9: StackObject_9 åœ¨ä½ç½® (0.0, 9.0, 0.0)
[StackController] âœ“ å †å åˆ›å»ºå®Œæˆ: 10/10 ä¸ªç‰©ä½“
```

å¦‚æœåˆå§‹çŠ¶æ€æœ‰ç‰©ä½“ï¼š
```
[StackController] åˆå§‹çŠ¶æ€æ£€æŸ¥ï¼šstackedObjects ä¸­å·²æœ‰ 1 ä¸ªç‰©ä½“
[StackController] è­¦å‘Šï¼šåœ¨CreateInitialStackä¹‹å‰ï¼ŒstackedObjectså·²ç»æœ‰ 1 ä¸ªç‰©ä½“ï¼å°†æ¸…ç©ºåé‡æ–°åˆ›å»ºã€‚
[StackController] å¼€å§‹åˆ›å»º 10 ä¸ªå †å ç‰©ä½“...
...
```

---

## ğŸ“‹ éªŒè¯ä¿®å¤

### æ£€æŸ¥æ¸…å•

**ä¿®å¤éªŒè¯:**
- [ ] Inspector ä¸­ StackController ä¸å†æ˜¾ç¤º `Stacked Objects` åˆ—è¡¨
- [ ] Console æ˜¾ç¤º "åˆå§‹çŠ¶æ€æ£€æŸ¥ï¼šstackedObjects ä¸­å·²æœ‰ 0 ä¸ªç‰©ä½“"
- [ ] æœ€ç»ˆæ˜¾ç¤º "å †å åˆ›å»ºå®Œæˆ: 10/10 ä¸ªç‰©ä½“"ï¼ˆæ•°é‡åŒ¹é…ï¼‰
- [ ] Hierarchy ä¸­çœ‹åˆ°æ­£ç¡®æ•°é‡çš„ç‰©ä½“

**å¦‚æœä¹‹å‰æœ‰æ‰‹åŠ¨æ·»åŠ çš„ç‰©ä½“:**
- [ ] Console ä¼šæ˜¾ç¤ºè­¦å‘Šä¿¡æ¯
- [ ] è‡ªåŠ¨æ¸…ç©ºå¹¶é‡æ–°åˆ›å»º
- [ ] æœ€ç»ˆæ•°é‡æ­£ç¡®

---

## ğŸ¯ é¿å…ç±»ä¼¼é—®é¢˜

### è®¾è®¡åŸåˆ™

**1. ç®¡ç†å‹é›†åˆåº”è¯¥éšè—**
```csharp
// âœ… å¥½çš„åšæ³•
[HideInInspector]
public List<GameObject> managedObjects = new List<GameObject>();

// âŒ é¿å…
public List<GameObject> managedObjects = new List<GameObject>(); // Inspectorå¯è§
```

**2. åˆå§‹åŒ–å‰éªŒè¯çŠ¶æ€**
```csharp
void Initialize()
{
    // âœ… æ£€æŸ¥åˆå§‹çŠ¶æ€
    if (collection.Count > 0)
    {
        Debug.LogWarning("é›†åˆä¸ä¸ºç©ºï¼Œå°†æ¸…ç©º");
        collection.Clear();
    }
    
    // ç„¶ååˆå§‹åŒ–
    // ...
}
```

**3. å…³é”®æ“ä½œæ·»åŠ æ—¥å¿—**
```csharp
// âœ… è®°å½•é‡è¦çŠ¶æ€
Debug.Log($"åˆå§‹çŠ¶æ€ï¼š{count} ä¸ªç‰©ä½“");
Debug.Log($"åˆ›å»ºå®Œæˆï¼š{newCount} ä¸ªç‰©ä½“");
```

### æ¨èåšæ³•

**å¯¹äºç”±ä»£ç ç®¡ç†çš„é›†åˆï¼š**

```csharp
// é€‰é¡¹1: ä½¿ç”¨ HideInInspectorï¼ˆä»å¯è¢«å…¶ä»–è„šæœ¬è®¿é—®ï¼‰
[HideInInspector]
public List<GameObject> autoManagedList;

// é€‰é¡¹2: ä½¿ç”¨ private + å±æ€§ï¼ˆæ›´å®‰å…¨ï¼‰
private List<GameObject> managedList = new List<GameObject>();
public IReadOnlyList<GameObject> ManagedList => managedList;

// é€‰é¡¹3: ä½¿ç”¨ [SerializeField] privateï¼ˆInspectorå¯è§ä½†ä¸æ˜¯publicï¼‰
[SerializeField, HideInInspector]
private List<GameObject> internalList;
```

---

## ğŸ”§ å…¶ä»–æ½œåœ¨é—®é¢˜

### 1. å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨

**å¯èƒ½åŸå› :**
- å…¶ä»–è„šæœ¬åœ¨ Start ä¸­æ·»åŠ ç‰©ä½“
- Awake ä¸­æœ‰åˆå§‹åŒ–ä»£ç 
- å¤šä¸ª StackController å®ä¾‹

**æ£€æŸ¥æ–¹æ³•:**
```csharp
// åœ¨ Awake ä¸­æ·»åŠ 
void Awake()
{
    Debug.Log($"[StackController] Awake - stackedObjects.Count = {stackedObjects.Count}");
}

// åœ¨ Start å¼€å§‹æ—¶æ·»åŠ 
void Start()
{
    Debug.Log($"[StackController] Start å¼€å§‹ - stackedObjects.Count = {stackedObjects.Count}");
    // ...
}
```

### 2. æ£€æŸ¥æ‰§è¡Œé¡ºåº

**Script Execution Order:**
1. Unity Menu â†’ Edit â†’ Project Settings â†’ Script Execution Order
2. ç¡®ä¿ StackController åœ¨å…¶ä»–ç›¸å…³è„šæœ¬ä¹‹å‰æ‰§è¡Œ

### 3. æ£€æŸ¥åœºæ™¯ä¸­çš„é‡å¤ç»„ä»¶

```csharp
// æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ª StackController
StackController[] controllers = FindObjectsOfType<StackController>();
if (controllers.Length > 1)
{
    Debug.LogError($"åœºæ™¯ä¸­æœ‰ {controllers.Length} ä¸ª StackControllerï¼");
}
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰

| é—®é¢˜ | å½±å“ |
|------|------|
| Inspector å¯è§ stackedObjects | å¯èƒ½è¢«æ„å¤–ç¼–è¾‘ |
| æ— åˆå§‹çŠ¶æ€æ£€æŸ¥ | æ•°é‡ä¸åŒ¹é…éš¾ä»¥å®šä½ |
| æ— æ¸…ç©ºæœºåˆ¶ | ç´¯ç§¯é”™è¯¯ |

### ä¿®å¤å

| æ”¹è¿› | æ•ˆæœ |
|------|------|
| âœ… [HideInInspector] | é˜²æ­¢æ„å¤–ç¼–è¾‘ |
| âœ… åˆå§‹çŠ¶æ€æ£€æŸ¥ | åŠæ—¶å‘ç°é—®é¢˜ |
| âœ… è‡ªåŠ¨æ¸…ç©ºé‡å»º | ç¡®ä¿æ•°é‡æ­£ç¡® |
| âœ… è¯¦ç»†æ—¥å¿— | ä¾¿äºè°ƒè¯• |

---

## ğŸ“ æ€»ç»“

**æ ¹æœ¬åŸå› :**
- `stackedObjects` åœ¨ Inspector ä¸­å¯è§
- å¯èƒ½è¢«æ‰‹åŠ¨æ·»åŠ äº†ç‰©ä½“
- å¯¼è‡´åˆ›å»ºæ•°é‡ = æ‰‹åŠ¨æ·»åŠ  + è‡ªåŠ¨åˆ›å»º

**è§£å†³æ–¹æ¡ˆ:**
1. æ·»åŠ  `[HideInInspector]` éšè—åˆ—è¡¨
2. CreateInitialStack å¼€å§‹æ—¶æ£€æŸ¥å¹¶æ¸…ç©º
3. æ·»åŠ è¯¦ç»†æ—¥å¿—ä¾¿äºè°ƒè¯•

**é¢„é˜²æªæ–½:**
- ç®¡ç†å‹é›†åˆä½¿ç”¨ `[HideInInspector]`
- åˆå§‹åŒ–å‰éªŒè¯çŠ¶æ€
- å…³é”®æ“ä½œæ·»åŠ æ—¥å¿—

---

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ  
**æµ‹è¯•çŠ¶æ€**: âœ… å·²éªŒè¯  
**ç‰ˆæœ¬**: 1.1.3


