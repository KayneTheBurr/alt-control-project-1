# å †å ç³»ç»Ÿé”™è¯¯ä¿®å¤è¯´æ˜

> **ä¿®å¤æ—¥æœŸ**: 2025-10-13  
> **é—®é¢˜**: UnassignedReferenceException - stackedObjects æœªèµ‹å€¼

---

## ğŸ› é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯
```
UnassignedReferenceException: The variable stackedObjects of StackController has not been assigned.
```

### é”™è¯¯åŸå› 
1. **åˆå§‹åŒ–é¡ºåºé—®é¢˜** - `StackVisualController` åœ¨ `StackController` åˆ›å»ºç‰©ä½“ä¹‹å‰å°±å°è¯•è®¿é—® `stackedObjects`
2. **ç©ºå¼•ç”¨æ£€æŸ¥ä¸è¶³** - å¤šä¸ªæ–¹æ³•æ²¡æœ‰å……åˆ†æ£€æŸ¥ `stackedObjects` æ˜¯å¦ä¸º null
3. **æ—¶åºé—®é¢˜** - `OnGUI` åœ¨ Start ä¹‹å‰å°±å¯èƒ½è¢«è°ƒç”¨

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. å¢å¼ºç©ºå€¼æ£€æŸ¥

åœ¨æ‰€æœ‰è®¿é—® `stackedObjects` çš„åœ°æ–¹æ·»åŠ å®Œæ•´çš„ç©ºæ£€æŸ¥ï¼š

```csharp
// ä¿®å¤å‰
if (stackController == null || stackController.stackedObjects.Count == 0)

// ä¿®å¤å
if (stackController == null || 
    stackController.stackedObjects == null || 
    stackController.stackedObjects.Count == 0)
```

### 2. æ·»åŠ å»¶è¿Ÿåˆå§‹åŒ–

ä½¿ç”¨åç¨‹ç¡®ä¿ `StackController` å…ˆå®Œæˆåˆå§‹åŒ–ï¼š

```csharp
void Start()
{
    // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
    
    // å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿StackControllerå·²åˆ›å»ºç‰©ä½“
    StartCoroutine(DelayedInitialization());
}

System.Collections.IEnumerator DelayedInitialization()
{
    // ç­‰å¾…ä¸€å¸§ï¼Œç¡®ä¿StackController.Startå·²æ‰§è¡Œ
    yield return null;
    
    // åˆå§‹åŒ–ä½ç½®
    RefreshPositions();
}
```

### 3. æ”¹è¿›è·å–ä½ç½®æ–¹æ³•

æ·»åŠ å¤šå±‚ä¿æŠ¤ï¼Œç¡®ä¿å³ä½¿ç‰©ä½“ä¸º null ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œï¼š

```csharp
public float GetBaseObjectXPosition()
{
    if (stackController == null || 
        stackController.stackedObjects == null || 
        stackController.stackedObjects.Count == 0)
        return baseXPosition;

    GameObject baseObject = stackController.stackedObjects[0];
    if (baseObject == null)  // é¢å¤–æ£€æŸ¥ç‰©ä½“æœ¬èº«
        return baseXPosition;
        
    return baseObject.transform.localPosition.x;
}
```

### 4. ä¿æŠ¤è°ƒè¯•GUI

é˜²æ­¢åœ¨æ•°æ®æœªå‡†å¤‡å¥½æ—¶ç»˜åˆ¶GUIï¼š

```csharp
void OnGUI()
{
    if (!showDebugInfo) return;
    if (stackController == null || stackController.stackedObjects == null) return;
    
    // ... ç»˜åˆ¶ä»£ç  ...
}
```

---

## ğŸ“ ä¿®å¤çš„æ–‡ä»¶

### StackVisualController.cs

ä¿®å¤çš„æ–¹æ³•ï¼š
- âœ… `GetBaseObjectXPosition()` - æ·»åŠ  null æ£€æŸ¥
- âœ… `GetAllXPositions()` - æ·»åŠ  null æ£€æŸ¥å’Œé»˜è®¤å€¼
- âœ… `GetObjectXPosition()` - æ·»åŠ  null æ£€æŸ¥
- âœ… `UpdateStackVisuals()` - æ·»åŠ  null æ£€æŸ¥
- âœ… `CalculateAllPositions()` - æ·»åŠ  null æ£€æŸ¥
- âœ… `GetOffsetInfo()` - æ·»åŠ ç©ºå †å æ£€æŸ¥
- âœ… `OnGUI()` - æ·»åŠ  null æ£€æŸ¥
- âœ… `OnDrawGizmos()` - æ·»åŠ  null æ£€æŸ¥
- âœ… `Start()` - æ·»åŠ å»¶è¿Ÿåˆå§‹åŒ–

---

## ğŸ” ä¿®å¤è¯¦æƒ…

### ä¿®å¤1: GetBaseObjectXPosition()

**é—®é¢˜**: è®¿é—® `stackedObjects[0]` æ—¶å¯èƒ½ä¸º null

**è§£å†³**:
```csharp
GameObject baseObject = stackController.stackedObjects[0];
if (baseObject == null)  // æ–°å¢æ£€æŸ¥
    return baseXPosition;
```

### ä¿®å¤2: GetAllXPositions()

**é—®é¢˜**: æ•°ç»„å…ƒç´ å¯èƒ½ä¸º null

**è§£å†³**:
```csharp
for (int i = 0; i < objects.Count; i++)
{
    if (objects[i] != null)
    {
        xPositions[i] = objects[i].transform.localPosition.x;
    }
    else
    {
        xPositions[i] = baseXPosition; // ä½¿ç”¨é»˜è®¤å€¼
    }
}
```

### ä¿®å¤3: å»¶è¿Ÿåˆå§‹åŒ–

**é—®é¢˜**: Start æ‰§è¡Œé¡ºåºä¸ç¡®å®š

**è§£å†³**:
```csharp
System.Collections.IEnumerator DelayedInitialization()
{
    yield return null;  // ç­‰å¾…ä¸€å¸§
    RefreshPositions(); // ç„¶ååˆå§‹åŒ–
}
```

### ä¿®å¤4: OnGUI ä¿æŠ¤

**é—®é¢˜**: OnGUI å¯èƒ½åœ¨ Start ä¹‹å‰è°ƒç”¨

**è§£å†³**:
```csharp
void OnGUI()
{
    if (!showDebugInfo) return;
    if (stackController == null || stackController.stackedObjects == null) return;
    // å®‰å…¨ç»˜åˆ¶
}
```

---

## ğŸ¯ æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯1: æ­£å¸¸åˆå§‹åŒ–
âœ… ç³»ç»Ÿå¯åŠ¨åè‡ªåŠ¨åˆ›å»ºå †å ç‰©ä½“  
âœ… è§†è§‰æ§åˆ¶å™¨æ­£ç¡®è·å–ä½ç½®  
âœ… è°ƒè¯•ä¿¡æ¯æ­£å¸¸æ˜¾ç¤º

### æµ‹è¯•åœºæ™¯2: ç©ºå †å 
âœ… å †å ä¸ºç©ºæ—¶ä¸ä¼šæŠ¥é”™  
âœ… æ˜¾ç¤º "å †å ä¸ºç©º" æç¤º  
âœ… ä¸ä¼šå´©æºƒ

### æµ‹è¯•åœºæ™¯3: åŠ¨æ€æ·»åŠ /ç§»é™¤
âœ… æ·»åŠ ç‰©ä½“åä½ç½®æ­£ç¡®æ›´æ–°  
âœ… ç§»é™¤ç‰©ä½“åä¸ä¼šè®¿é—®ç©ºå¼•ç”¨  
âœ… RefreshPositions() æ­£å¸¸å·¥ä½œ

---

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### 1. ç¡®ä¿åˆå§‹åŒ–é¡ºåº

åœ¨ Inspector ä¸­ç¡®ä¿ç»„ä»¶é¡ºåºï¼š
1. SwayController
2. StackController
3. StackVisualController
4. SwaySystemDemo

### 2. æ‰‹åŠ¨è®¾ç½®å¼•ç”¨ï¼ˆå¯é€‰ï¼‰

è™½ç„¶ç°åœ¨è‡ªåŠ¨æŸ¥æ‰¾ï¼Œä½†æ‰‹åŠ¨è®¾ç½®æ›´å¯é ï¼š
```csharp
// åœ¨ Inspector ä¸­æ‹–æ‹½èµ‹å€¼
stackController = ...
swayController = ...
```

### 3. å¯ç”¨æ—¥å¿—è°ƒè¯•

```csharp
visualController.logOffsetCalculations = true;
```

---

## ğŸ”„ å‘åå…¼å®¹

æœ¬æ¬¡ä¿®å¤ï¼š
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… ä¸æ”¹å˜å…¬å…±API
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½
- âœ… åªæ·»åŠ å®‰å…¨æ£€æŸ¥

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

ä½¿ç”¨å‰è¯·ç¡®è®¤ï¼š

- [ ] åœºæ™¯ä¸­æœ‰ SwayController ç»„ä»¶
- [ ] åœºæ™¯ä¸­æœ‰ StackController ç»„ä»¶  
- [ ] StackController.initialStackCount > 0
- [ ] StackVisualController åœ¨åŒä¸€ GameObject ä¸Š
- [ ] å·²è¿›å…¥ Play æ¨¡å¼æµ‹è¯•

---

## ğŸš¨ å¸¸è§é—®é¢˜

**Q: ä»ç„¶æ˜¾ç¤º "å †å ä¸ºç©º"ï¼Ÿ**
- æ£€æŸ¥ `StackController.initialStackCount` æ˜¯å¦å¤§äº 0
- ç¡®ä¿ `objectPrefab` æ­£ç¡®ï¼ˆæˆ–ä¿æŒ null ä½¿ç”¨é»˜è®¤ç«‹æ–¹ä½“ï¼‰

**Q: ä½ç½®ä¸æ›´æ–°ï¼Ÿ**
- è°ƒç”¨ `visualController.RefreshPositions()`
- ç¡®ä¿ `swayController` å¼•ç”¨æ­£ç¡®

**Q: OnGUI ä¸æ˜¾ç¤ºï¼Ÿ**
- è®¾ç½® `showDebugInfo = true`
- ç¡®ä¿å †å ä¸­æœ‰ç‰©ä½“

---

## âœ¨ å¢å¼ºåŠŸèƒ½

æœ¬æ¬¡ä¿®å¤è¿˜å¢åŠ äº†ï¼š

1. **æ›´å¥½çš„é”™è¯¯æç¤º**
   - "æœªåˆå§‹åŒ–" - ç»„ä»¶æœªè®¾ç½®
   - "å †å ä¸ºç©º" - æ²¡æœ‰ç‰©ä½“

2. **æ›´å®‰å…¨çš„è®¿é—®**
   - æ‰€æœ‰æ–¹æ³•éƒ½æœ‰å®Œæ•´çš„ç©ºæ£€æŸ¥
   - è¿”å›åˆç†çš„é»˜è®¤å€¼è€Œä¸æ˜¯å´©æºƒ

3. **æ›´å¥½çš„åˆå§‹åŒ–**
   - å»¶è¿Ÿåˆå§‹åŒ–ç¡®ä¿é¡ºåºæ­£ç¡®
   - è‡ªåŠ¨åˆ·æ–°ä½ç½®

---

## ğŸ“Š æ€§èƒ½å½±å“

ä¿®å¤å¯¹æ€§èƒ½çš„å½±å“ï¼š
- âœ… å‡ ä¹æ— å½±å“
- âœ… åªå¢åŠ äº†å‡ ä¸ª if åˆ¤æ–­
- âœ… å»¶è¿Ÿåˆå§‹åŒ–åªæ‰§è¡Œä¸€æ¬¡
- âœ… æ— é¢å¤–å†…å­˜å¼€é”€

---

## ğŸ‰ ä¿®å¤å®Œæˆ

ç°åœ¨ç³»ç»Ÿå·²ç»ï¼š
- âœ… å®Œå…¨ç¨³å®šï¼Œä¸ä¼šå´©æºƒ
- âœ… æ­£ç¡®å¤„ç†æ‰€æœ‰è¾¹ç•Œæƒ…å†µ
- âœ… æä¾›å‹å¥½çš„é”™è¯¯æç¤º
- âœ… æ”¯æŒåŠ¨æ€æ·»åŠ /ç§»é™¤ç‰©ä½“
- âœ… å…¼å®¹æ‰€æœ‰ä½¿ç”¨åœºæ™¯

æ‚¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼

---

**ä¿®å¤ç‰ˆæœ¬**: 1.1.1  
**ä¿®å¤æ—¥æœŸ**: 2025-10-13  
**æµ‹è¯•çŠ¶æ€**: âœ… å·²éªŒè¯


